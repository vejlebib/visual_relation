!function(){"use strict";function a(a){return a*a}var b=window.relvis=window.relvis||{},c=b.xy={};c.mul=function(a,b){return{x:a.x*b.x,y:a.y*b.y}},c.add=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},c.sub=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},c.scale=function(a,b){return{x:a.x*b,y:a.y*b}},c.inv=function(a){return{x:1/a.x,y:1/a.y}},c.assign=function(a,b){a.x=b.x,a.y=b.y},b.log=function(){if(b.logUrl){for(var a={},c=0;c<arguments.length;++c)a[c]=arguments[c];a.time=Date.now();var d=JSON.stringify(a);$.ajax(b.logUrl+"?"+window.encodeURIComponent(d)+"&callback=?",{dataType:"jsonp"})}},b.eventListeners={},b.addEventListener=function(a,c){var d=b.eventListeners[a]||[];b.eventListeners[a]=d;for(var e=0;e<d.length;++e)if(d[e]===c)return;d.push(c)},b.dispatchEvent=function(a,c){var d=b.eventListeners[a]||[];if(d)for(var e=0;e<d.length;++e)d[e].call(this,c)},b.nearestPoints=function(c,d,e){function f(a,b,c){a.nearestDist>c&&(a.nearestDist=c,a.nearestNode=b)}for(var g=0;g<c.length;++g)c[g].nearestDist=Number.POSITIVE_INFINITY;for(g=0;g<c.length;++g)for(var h=c[g],i=0;g>i;++i){var j=c[i],k=Math.sqrt(a(h[d]-j[d])+a((h[e]-j[e])*b.visualObjectRatio));f(h,j,k),f(j,h,k)}},b.findBoundaries=function(a){var b,c,d={},e={},f={};for(d.x=Number.POSITIVE_INFINITY,e.x=Number.NEGATIVE_INFINITY,d.y=Number.POSITIVE_INFINITY,e.y=Number.NEGATIVE_INFINITY,b=0;b<a.length;++b)c=a[b],"number"==typeof c.x&&(d.x=Math.min(c.x,d.x),e.x=Math.max(c.x,e.x)),"number"==typeof c.y&&(d.y=Math.min(c.y,d.y),e.y=Math.max(c.y,e.y));return f.x=e.x-d.x,f.y=e.y-d.y,{min:d,max:e,range:f,zeroOne:function(a){var b={};return b.y=(a.y-this.min.y)/this.range.y,b.x=(a.x-this.min.x)/this.range.x,b}}},b.nextTick=function(a){setTimeout(a,0)},b.throttle=function(a,b){function c(){d&&(b(),d=!1),e=!1}var d=!1,e=!1;return function(){d=!0,e||(c(),e=!0,window.setTimeout(c,a))}}}(),function(){"use strict";function a(a){return function(o){var p=k.canvas;if(o.preventDefault(),!(Date.now()<m)){var q={orig:o};q.isTouch=!!o.touches,o.touches&&o.touches[0]&&(q.x=o.touches[0].clientX,q.y=o.touches[0].clientY),q.isTouch||(q.x=o.clientX,q.y=o.clientY),"undefined"==typeof q.x?(q.x=d,q.y=e):(q.x=q.x*p.width/p.clientWidth,q.y=q.y*p.height/p.clientHeight),"start"===a&&(i=j=0,g=Date.now(),l=!0,d=b=q.x,e=c=q.y),"number"==typeof q.x&&(i=Math.max(i,Math.abs(q.x-b)),j=Math.max(j,Math.abs(q.y-c)),q.node=k.nodeAt(q.x,q.y),q.dx=q.x-b,q.dy=q.y-c,q.ddx=q.x-d,q.ddy=q.y-e,d=q.x,e=q.y,f=q.node),"start"===a?h=q.node:q.startNode=h,q.node||(q.node=f),(l||"start"===a)&&k.dispatchEvent("tap"+a,q),"end"===a&&(Date.now()-g<n&&Math.sqrt(i*i+j*j)<k.unit?k.dispatchEvent("tapclick",q):k.dispatchEvent("drag",q),l=!1)}}}var b,c,d,e,f,g,h,i,j,k=window.relvis=window.relvis||{},l=!1,m=0,n=300;k.initCanvas=function(){if(!k.canvas){var b=k.canvas=document.createElement("canvas");b.className="CanvasOverlay",k.overlayVisible=!1,k.unit=12*(window.devicePixelRatio||1),$(window).scroll(function(){k.updateOverlayPosition()}),$(window).resize(function(){k.updateOverlayPosition()}),b.addEventListener("touchstart",a("start")),b.addEventListener("mousedown",a("start")),b.addEventListener("touchmove",a("move")),b.addEventListener("mousemove",a("move")),b.addEventListener("touchend",a("end")),b.addEventListener("mouseup",a("end")),b.addEventListener("mouseleave",a("end"))}},k.showCanvasOverlay=function(){this.overlayVisible||(this.overlayVisible=!0,m=Date.now()+3*n,this._originalOverflow=document.body.style.overflow,document.body.style.overflow="hidden",document.body.appendChild(this.canvas),k.updateOverlayPosition())},k.hideCanvasOverlay=function(){this.overlayVisible&&(this.overlayVisible=!1,this.canvas.parentElement&&document.body.removeChild(this.canvas),document.body.style.overflow=this._originalOverflow)},k.updateOverlayPosition=function(){if(this.overlayVisible){k.unit=12*(window.devicePixelRatio||1);var a=this.canvas.width,b=this.canvas.height,c=window.devicePixelRatio||1,d=window.scrollX||window.pageXOffset||0,e=window.scrollY||window.pageYOffset||0,f=document.documentElement.clientWidth*c,g=document.documentElement.clientHeight*c,h=window.innerWidth,i=window.innerHeight;this.canvas.style.position="absolute",this.canvas.style.zIndex=1e9,this.canvas.style.top=e+"px",this.canvas.style.left=d+"px",this.canvas.style.width=h+"px",this.canvas.style.height=i+"px",(a!==f||b!==g)&&(this.canvas.width=f,this.canvas.height=g,this.requestRedraw())}}}(),function(){"use strict";var a=window.relvis=window.relvis||{},b={};a.textLayout=function(a,c,d,e){function f(c){var d=e+","+c;return b[d]=b[d]||a.measureText(c).width}window.ctx=a;for(var g=c.split(" "),h=f(" "),i=g.map(f),j=[],k=[],l=0,m=0;m<g.length;++m)l>0&&l+i[m]>d&&(j.push({str:k.join(" "),len:l}),k=[],l=0),k.push(g[m]),l+=i[m]+h;return j.push({str:k.join(" "),len:l}),j},a.writeBox=function(b,c,d,e,f,g,h){var i,j,k;h=h||{};var l=6*a.unit;do for(l=.9*l|0,b.font=l+"px sans-serif",i=a.textLayout(b,c,f,l),k=0,j=0;j<i.length;++j)k=Math.max(k,i[j].len);while(l>a.unit&&(k>f||i.length*l>g));for(h.vcenter&&(e+=(g-l*(i.length+.5))/2),j=0;j<i.length;++j)g>l*(j+1)&&b.fillText(i[j].str,d,e+l*(j+1))}}(),function(){"use strict";var a=window.relvis=window.relvis||{},b=a.triples={},c=a.throttle(100,function(){a.dispatchEvent("data-update")});a.addTriple=function(b,d,e){if(e){var f=a.getValues(b,d);e in f||(f.push(e),c())}},a.removeTriple=function(b,d,e){var f=a.getValues(b,d),g=f.indexOf(e);-1!==g&&(f[g]=f[f.length-1],f.pop(),c())},a.getValues=function(c,d){return b[c]||(b[c]={}),b[c][d]||(b[c][d]=[],a.dispatchEvent("get-triple",{object:c,property:d})),b[c][d]},a.getProperties=function(a){var c={};return b[a]||(b[a]={}),Object.keys(b[a]).forEach(function(d){b[a][d].length&&(c[d]=JSON.parse(JSON.stringify(b[a][d])))}),c},a.initData=function(){c()};var d={},e={};a.addEventListener("get-triple",function(b){function c(b){return 1>b?void a.log("apierr",f):void $.ajax(a.apiUrl+"/get-ting-object/"+f+"?callback=?",{cache:!0,dataType:"jsonp",success:function(b){b.forEach(function(b){a.addTriple(f,b.type||b.property,b.value)})},error:function(){c(b-1)}})}var f=b.object;if(f){if("related"===b.property){if(e[f])return;return e[f]=!0,void a.nextTick(function(){if(a.relatedApiUrl){var b=f.split(/(:|%3A)/)[2];$.ajax(a.relatedApiUrl+"/related/"+b+"?callback=?",{cache:!0,dataType:"jsonp",success:function(b){Array.isArray(b)&&(b=b.map(function(a){return a.id="870970-basis:"+a.lid,a}),a.addTriple(f,"related",b))},error:function(){a.log("apierr","related-"+f)}})}else{var c=a.apiUrl+"/get-recommendations/"+f+"/30";$.ajax(c+"?callback=?",{cache:!0,dataType:"jsonp",success:function(b){Array.isArray(b)&&(0===b.length&&(b=[]),b=b.map(function(a){return{id:a}}),a.addTriple(f,"related",b))},error:function(){a.log("apierr","related-"+f)}})}})}if(!d[b.object])return d[b.object]=!0,"search:"===f.slice(0,7)?void $.ajax(a.apiUrl+"/get-search-result/ting-search/"+f.slice(7)+"?callback=?",{cache:!0,dataType:"jsonp",success:function(b){for(var c=[],d=b.collections,e=0;e<d.length;++e)for(var g=d[e].entities,h=0;h<g.length;++h)c.push(g[h]);a.addTriple(f,"results",c)},error:function(){a.log("apierr",f)}}):void(f.match(/[0-9]+-[a-zæøå]+:[0-9]*/)&&c(3))}})}(),function(){"use strict";var a=window.relvis=window.relvis||{};a.nodes=[],a.edges=[],a.addEventListener("data-update",a.throttle(300,function(){function b(b){var c=m[b.id]||o[b.id];if(c){for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);b=c}return void 0===b.imgSrc&&(b.imgSrc=a.getValues(b.id,"cover")[0]),(void 0===b.label||"..."===b.label)&&(b.label=a.getValues(b.id,"title")[0]||"..."),m[b.id]=b,b}function c(){function c(){var f,g,h,i,j,k;if(f=e,e=[],k=d[0],d=d.slice(1),"number"==typeof k){for(h=0;h<f.length;++h){g=f[h],m[g]||a.log("errnodemap",g),j=m[g];var l=a.getValues(g,"related");if(l.length){l=l[0];var n=0;for(i=0;k>n&&i<l.length;++i){var o=l[i].id;if(!m[o]){++n;var p=b({id:o,value:o,visible:!0});e.push(o),q.push({source:j,target:p})}}}}c()}}a.d3force&&a.d3force.gravity(0);var d,e=[];for(d=l.length<=1?[9,3]:l.length<=2?[4,3]:l.length<=3?[3,2]:l.length<=7?[2,2]:l.length<=13?[3]:l.length<=20?[2]:[1],f=0;f<l.length;++f)for(e.push(l[f]),b({id:l[f],value:l[f],type:"primary",visible:!0}),g=0;f>g;++g)q.push({source:m[l[f]],target:m[l[g]],type:"collection"});c()}function d(){function c(c,f){function g(){var a;j={};var c={},d=[];for(var f in e)if(e.hasOwnProperty(f))for(j[f]=b({id:"category:"+f,label:f,type:"category",visible:!1}),d.push(j[f]),a=0;a<e[f].length;++a)c[e[f][a]]=f;d[0].fixedPosition={x:0,y:0},d[1].fixedPosition={x:1,y:0},d[2].fixedPosition={x:0,y:1},d[3].fixedPosition={x:1,y:1}}function h(){Object.keys(e).forEach(function(g){e[g].forEach(function(e){a.getValues(c,e).forEach(function(c){var h=b({id:f+"-"+e+"-"+c,label:c,property:e,value:c,visible:!0});h.label.trim().match(/^\d\d\d\d\d\d-[a-z]*:\d*$/)&&(h.label=a.getValues(h.label,"title")[0]||"...","Anmeldelse"===h.label&&(h.label=a.getValues(h.value,"isPartOf")[0]||h.label)),q.push({source:j[g],target:h}),q.push({source:d,target:h})})})})}function i(){d=b({id:c,value:c,label:"root",type:"root",visible:!0}),d.imgSrc=a.getValues(c,"cover")[0],d.label=a.getValues(c,"title")[0]||"..."}var j;i(),g(),h()}var d,e={authorInfo:["creator","dbcaddi:hasCreatorDescription"],review:["dbcaddi:hasReview","dbcaddi:hasAnalysis","dbcaddi:hasDescriptionFromPublisher","dbcaddi:discussedIn"],circular:["subject"],structure:["dbcaddi:isAnalysisOf","dbcaddi:isReviewOf","dbcbib:isPartOfManifestation","dbcaddi:isDescriptionFromPublisherOf","dbcaddi:discusses","dbcaddi:hasAdaptation","dbcaddi:isAdaptationOf","dbcaddi:isManuscriptOf","dbcaddi:hasManuscript","dbcaddi:continues","dbcaddi:continuedIn","dbcaddi:isSoundtrackOfMovie","dbcaddi:isSoundtrackOfGame","dbcaddi:hasSoundtrack","dbcaddi:isPartOfAlbum","dbcaddi:hasTrack"]};for(a.d3force&&a.d3force.gravity(1),f=0;f<l.length;++f)for(c(l[f],l),g=0;f>g;++g)q.push({source:m[l[f]],target:m[l[g]],type:"collection"})}function e(){var c;a.d3force&&a.d3force.gravity(1);var d=["creator","subject","type"];for(f=0;f<l.length;++f)c=b({id:l[f],value:l[f],type:"primary",visible:!0});var e={};for(f=0;f<l.length;++f)for(h=l[f],g=0;g<d.length;++g){var i=d[g],k=a.getValues(h,i);for(j=0;j<k.length;++j){var n=i+"\x00"+k[j];e[n]=(e[n]||0)+1}}var o=[];for(Object.keys(e).forEach(function(a){e[a]>1&&o.push({name:a.split("\x00")[0],value:a.split("\x00")[1],count:e[a]})}),o.sort(function(a,b){return b.count-a.count}),o=o.slice(0,20),f=0;f<o.length;++f){var p=o[f];for(c=b({id:p.name+p.value,label:p.value,type:"category",subtype:p.name,visible:!0}),g=0;g<l.length;++g)-1!==a.getValues(l[g],p.name).indexOf(p.value)&&q.push({source:c,target:m[l[g]],type:"category"})}}var f,g,h,i,j,k=a.getType(),l=a.getIds(),m={},n=30;for(f=0;f<l.length;++f)if(h=l[f],"search:"===h.slice(0,7)&&(i=a.getValues(h,"results"),i.length))return l=h.slice(0,f).concat(i[0].slice(0,n)).concat(l.slice(f+1)),void a.setIds(l);var o={};a.nodes.forEach(function(a){o[a.id]=a});var p=a.nodes=[],q=a.edges=[];"ext"===k?d():"cir"===k?c():"str"===k&&e();for(var r in m)m.hasOwnProperty(r)&&p.push(m[r]);return a.layoutGraph(),{nodes:p,edges:q}}))}(),function(){"use strict";var a=window.relvis=window.relvis||{};a.d3force=void 0,a.layoutGraph=a.throttle(300,function(){var b=a.d3force;b||(b=window.d3.layout.force().size([window.innerWidth,window.innerHeight]).charge(-200).gravity(.5).linkDistance(30),b.on("tick",function(){var b=a.nodes.filter(function(a){return a.visible});if(b.length<10)for(var c=0;c<b.length;++c){var d=b[c];d.y=d.py=-Math.sin(2*Math.PI*c/b.length),d.x=d.px=-Math.cos(2*Math.PI*c/b.length)}var e=a.findBoundaries(b);a.nodes.forEach(function(a){a.fixedPosition&&(a.x=a.fixedPosition.x*e.range.x+e.min.x,a.y=a.fixedPosition.y*e.range.y+e.min.y)}),a.requestRedraw()}),a.d3force=b),b.nodes(a.nodes).links(a.edges).start()})}(),function(){"use strict";function a(){}function b(a){e=a}var c,d=window.relvis=window.relvis||{},e=window.navigator.userAgent,f={};d.initUI=function(){d.addEventListener("tapstart",function(a){c=a.node||{},f=d.toGraphCoord(a),b("tapstart "+JSON.stringify({pos:f,x:a.x,y:a.y,node:c.label})),c.fixed=!0,c.highlight=!0,d.fixedViewport=!0,d.requestRedraw()}),d.addEventListener("tapmove",function(a){var e=d.toGraphCoord(a),g=d.xy.sub(e,f);b("tapmove"+JSON.stringify({dpos:g,x:a.x,y:a.y,node:c.label})),d.xy.assign(c,d.xy.add(c,g)),d.xy.assign(c,e),c.px=c.x,c.py=c.y,f=d.toGraphCoord(a),d.requestRedraw(),d.layoutGraph()}),d.addEventListener("tapend",function(a){b("tapend"+JSON.stringify({x:a.x,y:a.y,node:c.label})),c.fixed=!1,c.highlight=!1,d.fixedViewport=!1,d.requestRedraw(),d.layoutGraph()}),d.addEventListener("drag",function(a){var e,f;if(b("drag"+JSON.stringify({x:a.x,y:a.y,w:d.canvas.width,h:d.canvas.height})),d.log("drag ",c&&c.id),"cir"===d.getType()&&c){var g=d.getIds(),h=g.indexOf(c.id);e=a.x/d.canvas.width*2-1,f=a.y/d.canvas.height*2-1,.2>e*e+f*f?-1===h&&(d.log("add-node",c.id),g.push(c.id),d.setIds(g)):-1!==h&&g.length>1&&(d.log("remove-node",c.id),g.splice(h,1),d.setIds(g))}}),d.addEventListener("tapclick",function(a){b("tapclick"+JSON.stringify({x:a.x,y:a.y,node:c.label})),c.id?(d.log("click",c.id),d.clickHandle({visualisation:d.getType(),id:c.value,title:c.label,properties:d.getProperties(c.value)})):(d.log("click"),d.closeHandle())}),d.addEventListener("redraw",a)}}(),function(){"use strict";function a(a){a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0}function b(a){l&&(a.shadowBlur=2*i.unit),a.shadowOffsetX=i.unit/2,a.shadowOffsetY=i.unit/2,a.shadowColor="rgba(0,0,0,0.4)"}function c(a){if(!a)return void 0;var b=j[a];return b||(b=j[a]=new Image,b.src=a,b.onload=i.requestRedraw),b}function d(a,b,c,d,e){a.shadowBlur=i.unit/2,a.shadowColor="#fff",a.fillStyle="#000",a.font=3*i.unit+"px sans-serif",a.fillText("Forfatter",b+4*i.unit,c+4*i.unit);var f=a.measureText("Anmeldelser").width;a.fillText("Anmeldelser",b+d-f-4*i.unit,c+4*i.unit),a.fillText("Emner",b+4*i.unit,c+e-2*i.unit),f=a.measureText("Struktur").width,a.fillText("Struktur",b+d-f-4*i.unit,c+e-2*i.unit),a.shadowBlur=0}function e(c,d,e){b(c),c.fillStyle="rgba(255,255,255,1.0)",c.strokeStyle="rgba(255,255,255,1.0)",c.lineWidth=i.unit/2,c.lineCap="round",c.beginPath(),c.moveTo(e-3*i.unit,d+i.unit),c.lineTo(e-1*i.unit,d+3*i.unit),c.moveTo(e-3*i.unit,d+3*i.unit),c.lineTo(e-1*i.unit,d+1*i.unit),c.stroke(),a(c),c.lineCap="butt"}function f(a,c,d,e,f,g){var h=c.naturalWidth,i=c.naturalHeight,j=Math.min(f/h,g/i);h=h*j|0,i=i*j|0;var k=d+(f-h)/2|0,l=e+(g-i)/2|0;b(a),a.drawImage(c,k,l,h,i)}function g(b,c,d,e,f,g){b.shadowBlur=i.unit/2;var h={creator:"#f88",type:"#88f",subject:"#8f8"}[c.subtype]||"#fff";b.fillStyle="#000",b.shadowColor=h,i.writeBox(b,c.label,d,e,f,g,{vcenter:!0}),a(b)}function h(d,e,f,g,h,j){b(d),d.fillStyle="rgba(255,255,255,1)",d.fillRect(f,g,h,j),a(d);var k=c(i.getValues(e.value,"defaultCover")[0]);k&&k.complete&&k.naturalWidth&&(d.drawImage(k,f+.1*h,g+.1*j,.8*h,.8*j),d.fillStyle="rgba(255,255,255,0.5)",d.fillRect(f,g,h,j)),f+=h/10,g+=j/10,h*=.8,j*=.8,d.fillStyle="rgba(0,0,0,0.8)",i.writeBox(d,e.label,f,g,h,j)}var i=window.relvis=window.relvis||{};i.visualObjectRatio=13/8,i.visualObjectRatio=.75;var j={},k=0,l=!0;i.addEventListener("redraw",function(){i.renderTime>150?(++k,k>5&&(l=!1)):k=0}),i.drawBackground=function(a,b,c,f,g){a.fillStyle="rgba(200,200,200,0.9)",a.fillRect(b,c,f,g),"ext"===i.getType()&&i.nodes.length>=15&&d(a,b,c,f,g),e(a,c,f)},i.drawEdge=function(b,c,d,e,f,g){"collection"===c.type?(b.lineWidth=10*i.unit,b.strokeStyle="rgba(255,255,255,0.5)",b.lineCap="round"):(b.lineWidth=i.unit/4,b.strokeStyle="rgba(255,255,255,1)",b.lineCap="butt",(c.source.highlight||c.target.highlight)&&(b.strokeStyle="rgba(30,40,20,1)")),b.beginPath(),b.moveTo(d,e),b.lineTo(f,g),b.stroke(),a(b)},i.drawNode=function(a,b,d,e,j,k){var l=c(b.imgSrc);!l&&"..."===b.label&&i.loadingCover&&(l=c(i.loadingCover)),l&&l.complete&&l.naturalWidth?f(a,l,d,e,j,k):"category"===b.type?g(a,b,d,e,j,k):h(a,b,d,e,j,k)}}(),function(){"use strict";var a=window.relvis=window.relvis||{};a.fixedViewport=!1;var b=a.xy;a.offset={x:123,y:456},a.scale={x:7,y:8},a.toCanvasCoord=function(c){return b.mul(b.sub(c,a.offset),a.scale)},a.toGraphCoord=function(c){return b.add(b.mul(c,b.inv(a.scale)),a.offset)},a.nodeAt=function(b,c){for(var d=0;d<a.nodes.length;++d){var e=a.nodes[d];if(Math.abs(e.vx-b)<=e.xsize&&Math.abs(e.vy-c)<=e.ysize)return e}return void 0},a.addEventListener("redraw",function(){var c=a.topMargin*(window.devicePixelRatio||1),d=a.bottomMargin*(window.devicePixelRatio||1);if(a.nodes&&a.overlayVisible){var e=Date.now(),f=a.nodes.filter(function(a){return a.visible}),g=a.canvas,h=g.getContext("2d");if(h.clearRect(0,0,g.width,g.height),a.drawBackground(h,0,c,g.width,g.height-c-d),!a.fixedViewport&&f.length&&"number"==typeof f[0].x){var i=5*a.avgSize/(a.canvas.height+a.canvas.width)||0,j=a.findBoundaries(f);0===j.range.x&&(j.min.x-=1,j.min.y-=1,j.max.x-=1,j.max.y-=1,j.range.x=2,j.range.y=2),a.offset=b.sub(j.min,b.scale(j.range,i)),a.scale=b.scale(j.range,1+2*i),a.scale=b.mul({x:g.width,y:g.height-(d+c)},b.inv(a.scale)),a.offset.y-=c/a.scale.y}f.forEach(function(b){var c=a.toCanvasCoord(b);b.vx=c.x,b.vy=c.y}),a.nearestPoints(f,"vx","vy");var k=0;a.avgSize=0,f.forEach(function(b){var c;c=b.nearestNode?(.8*b.nearestDist-.2*b.nearestNode.nearestDist)*Math.SQRT1_2:Math.min(a.canvas.height,a.canvas.width)/2.8,b.xsize=c,b.ysize=c/a.visualObjectRatio,++k,a.avgSize+=c}),a.avgSize/=k;var l=a.edges.filter(function(a){return a.source.visible&&a.target.visible});l.forEach(function(b){b.visible!==!1&&a.drawEdge(h,b,b.source.vx,b.source.vy,b.target.vx,b.target.vy)});for(var m=0;m<f.length;++m){var n=f[m],o=n.vx-n.xsize,p=n.vy-n.ysize;a.drawNode(h,n,o,p,2*n.xsize,2*n.ysize)}a.renderTime=Date.now()-e}}),a.requestRedraw=a.throttle(50,function(){a.nextTick(function(){a.dispatchEvent("redraw",{})})})}(),function(){"use strict";function a(a){return function(){var b=a.getAttribute("data-relvis-id").replace(/%3[aA]/g,":"),c=(a.getAttribute("data-relvis-type")||"ext").slice(0,3);location.hash="#relvis/"+c+b,d.show()}}function b(b){var c=a(b);b.className=b.className.replace("relvis-request","relvis-enabled"),b.addEventListener("mousedown",c),b.addEventListener("click",c),b.addEventListener("touchstart",c)}function c(a){a.className=a.className.replace("relvis-request","relvis-disabled")}var d=window.relvis=window.relvis||{},e=!1;d.getType=function(){return location.hash.slice(8,11)},d.getIds=function(){return location.hash.slice(11).split(",")},d.setIds=function(a){location.hash=location.hash.slice(0,11)+String(a),d.dispatchEvent("data-update")},d.close=function(){location.hash="",d.hideCanvasOverlay()},d.show=function(){d.overlayVisible||(e||(d.initData(),d.initCanvas(),d.initUI(),e=!0),d.nodes=[],d.edges=[],d.showCanvasOverlay(),d.log("start",location.hash.slice(8)))},d.init=function(a){d.apiUrl=a.apiUrl,d.logUrl=a.logUrl,d.loadingCover=a.loadingCover,d.clickHandle=a.clickHandle||function(){},d.relatedApiUrl=a.relatedUrl,d.disablePrefetch=a.disablePrefetch,d.closeHandle=a.closeHandle||d.close,d.topMargin=a.topMargin||0,d.bottomMargin=a.bottomMargin||0,d.log("init",{apiUrl:d.apiUrl,relatedApiUrl:a.relatedUrl,prefetch:!d.disablePrefetch,href:location.href}),d.unsupportedPlatform=function(){var a=document.createElement("canvas");if(!a.getContext)return"Missing canvas support";var b=navigator.userAgent.match(/android.*?([12]\.[0-9])/i);return b&&+b[1]<2.2&&!navigator.userAgent.match(/(firefox|chrome|opera)/i)?"Buggy android version:\n"+navigator.userAgent:!1}(),"#relvis"!==location.hash.slice(0,7)||d.unsupportedPlatform||d.show(),$(window).on("hashchange",function(){"#relvis"!==location.hash.slice(0,7)||d.unsupportedPlatform?d.hideCanvasOverlay():d.show(),d.dispatchEvent("data-update")}),d.addEventListener("data-update",d.updateButtons),d.nextTick(d.updateButtons)},d.open=function(a,b){location.hash="relvis/"+a.slice(0,3)+String(b)},d.updateButtons=d.throttle(300,function(){var a,e,f=document.getElementsByClassName("relvis-request"),g=[];for(a=0;a<f.length;++a)g.push(f[a]);var h=[];for(a=0;a<g.length;++a){var i=g[a];if(d.unsupportedPlatform)c(i);else if(d.disablePrefetch)b(i),h.push(i.getAttribute("data-relvis-id"));else{var j=i.getAttribute("data-relvis-id").replace(/%3[aA]/g,":").split(","),k=j[0],l=(i.getAttribute("data-relvis-type")||"ext").slice(0,3);if("search:"===k.slice(0,7))d.getValues(k,"results").length>0&&(b(i),h.push(i.getAttribute("data-relvis-id")));else if("cir"===l){var m=0;for(e=0;e<j.length;++e){k=j[e],d.getValues(k,"title");var n=d.getValues(k,"related");n.length>0&&(0===n[0].length?++m:(b(i),h.push(i.getAttribute("data-relvis-id"))))}m===j.length&&c(i)}else d.getValues(k,"title").length>0&&(b(i),h.push(i.getAttribute("data-relvis-id")))}}h.length>0&&d.log("enabled",h)})}();